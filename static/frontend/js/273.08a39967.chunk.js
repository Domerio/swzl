"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[273],{116:function(e,t,r){var i=r(6518),a=r(2652),s=r(9306),o=r(8551),l=r(1767);i({target:"Iterator",proto:!0,real:!0},{find:function(e){o(this),s(e);var t=l(this),r=0;return a(t,(function(t,i){if(e(t,r++))return i(t)}),{IS_RECORD:!0,INTERRUPTED:!0}).result}})},273:function(e,t,r){r.r(t),r.d(t,{default:function(){return m}});var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"lost-item-register"},[t("h1",[e._v("📝 失物登记")]),t("el-form",{ref:"formRef",attrs:{model:e.form,"label-width":"120px",rules:e.rules,"label-position":"top"}},[t("el-form-item",{attrs:{label:"物品标题",prop:"title"}},[t("el-input",{attrs:{placeholder:"请输入物品名称（如：黑色华为手机）"},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),t("el-form-item",{attrs:{label:"详细描述",prop:"description"}},[t("el-input",{attrs:{type:"textarea",rows:4,placeholder:"请尽可能详细描述物品特征（如：型号、特殊标记等）","show-word-limit":"",maxlength:"300"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"丢失时间",prop:"lost_time"}},[t("el-date-picker",{attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm","value-format":"yyyy-MM-ddTHH:mm",placeholder:"选择具体时间"},model:{value:e.form.lost_time,callback:function(t){e.$set(e.form,"lost_time",t)},expression:"form.lost_time"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"丢失地点",prop:"location"}},[t("el-input",{attrs:{placeholder:"例如：3号教学楼201教室"},model:{value:e.form.location,callback:function(t){e.$set(e.form,"location",t)},expression:"form.location"}})],1)],1)],1),t("el-form-item",{attrs:{label:"物品分类",prop:"category"}},[t("el-select",{attrs:{placeholder:"请选择最匹配的分类",filterable:""},model:{value:e.form.category,callback:function(t){e.$set(e.form,"category",t)},expression:"form.category"}},e._l(e.categories,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"联系方式",prop:"contact"}},[t("el-input",{attrs:{placeholder:"手机号或邮箱"},model:{value:e.form.contact,callback:function(t){e.$set(e.form,"contact",t)},expression:"form.contact"}})],1),t("el-form-item",{attrs:{label:"物品照片"}},[t("el-upload",{attrs:{action:"#","list-type":"picture-card","auto-upload":!1,"on-change":e.handleUploadSuccess,"file-list":e.form.images,"before-upload":e.beforeUpload}},[t("i",{staticClass:"el-icon-plus"})]),t("div",{staticClass:"el-upload__tip"},[e._v(" 支持上传 JPG/PNG 格式图片，单张不超过5MB ")])],1),t("el-form-item",[t("el-button",{staticClass:"submit-btn",attrs:{type:"primary",loading:e.isSubmitting},on:{click:e.submitForm}},[e._v(" "+e._s(e.isSubmitting?"提交中...":"立即登记")+" ")])],1)],1),t("el-dialog",{attrs:{title:"✅ 登记成功",visible:e.dialogVisible,width:"700px"},on:{"update:visible":function(t){e.dialogVisible=t},closed:e.handleDialogClosed}},[t("el-descriptions",{attrs:{column:2,border:"","label-class-name":"detail-label"}},[t("el-descriptions-item",{attrs:{label:"物品标题"}},[e._v(e._s(e.submittedItem.title))]),t("el-descriptions-item",{attrs:{label:"分类"}},[e._v(" "+e._s(e.getCategoryName(e.submittedItem.category))+" ")]),t("el-descriptions-item",{attrs:{label:"丢失时间"}},[e._v(" "+e._s(e.submittedItem.lost_time)+" ")]),t("el-descriptions-item",{attrs:{label:"丢失地点"}},[e._v(e._s(e.submittedItem.location))]),t("el-descriptions-item",{attrs:{label:"联系方式",span:2}},[t("el-link",{attrs:{type:"primary"}},[e._v(e._s(e.submittedItem.contact))])],1),t("el-descriptions-item",{attrs:{label:"详细描述",span:2}},[t("pre",{staticClass:"description-pre"},[e._v(e._s(e.submittedItem.description))])]),e.submittedItem.images?.length?t("el-descriptions-item",{attrs:{label:"物品照片",span:2}},e._l(e.submittedItem.images,(function(e,r){return t("el-image",{key:r,staticClass:"detail-image",attrs:{src:e.url,fit:"cover"}})})),1):e._e()],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"success"},on:{click:e.handleConfirm}},[e._v(" 打印回执 (Ctrl+P) ")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogVisible=!1}}},[e._v(" 确定返回 ")])],1)],1)],1)},a=[],s=(r(8111),r(116),r(7588),r(4603),r(7566),r(8721),r(4335)),o={data(){return{phoneRules:[{required:!0,message:"请输入联系方式",trigger:"blur"},{pattern:/^(1[3-9]\d{9}|[\w-]+@[\w-]+\.[\w-]+)$/,message:"请输入有效的手机号或邮箱",trigger:"blur"}],form:{title:"",description:"",lost_time:null,location:"",category:null,contact:"",images:[]},categories:[],fileList:[],rules:{title:[{required:!0,message:"请输入标题",trigger:"blur"}],description:[{required:!0,message:"请输入详细描述",trigger:"blur"}],lost_time:[{required:!0,message:"请选择丢失时间",trigger:"change"}],location:[{required:!0,message:"请输入地点",trigger:"blur"}],category:[{required:!0,message:"请选择物品分类",trigger:"change"}],contact:[{required:!0,message:"请输入联系方式",trigger:"blur"}]},isSubmitting:!1,dialogVisible:!1,submittedItem:{},printStyle:"\n      @media print {\n        body * { visibility: hidden; }\n        .el-dialog { width: 210mm!important; visibility: visible; }\n        .el-dialog__header, .el-dialog__footer { display: none; }\n      }\n    "}},mounted(){this.fetchCategories(),document.addEventListener("keydown",(e=>{e.ctrlKey&&"p"===e.key&&this.dialogVisible&&(e.preventDefault(),this.handleConfirm())}))},methods:{getCategoryName(e){return this.categories.find((t=>t.id===e))?.name||"未知分类"},handleDialogClosed(){this.$router.go(-1)},handleConfirm(){const e=window.open("","_blank");e.document.write(`\n      <style>${this.printStyle}</style>\n      ${document.querySelector(".el-dialog").outerHTML}\n    `),e.print(),e.close()},async fetchCategories(){try{const e=await s.A.get("/api/categories/");this.categories=e.data}catch(e){console.error("获取物品分类失败:",e),this.$message.error("获取物品分类失败，请稍后重试。")}},async submitForm(){try{this.isSubmitting=!0;const e=new FormData;Object.keys(this.form).forEach((t=>{"images"!==t&&e.append(t,this.form[t])})),this.form.images.forEach((t=>{e.append("images",t.raw)}));const t=await s.A.post("/api/items/lost/",e,{headers:{"Content-Type":"multipart/form-data",Authorization:`Token ${this.$store.state.token}`}});this.submittedItem={...t.data,images:this.form.images},this.$refs.formRef.resetFields(),this.form.images=[],this.dialogVisible=!0,this.$message.success({message:"登记成功，3秒后自动跳转",duration:3e3})}catch(e){const t=e.response?.data?.detail||"提交失败，请检查网络连接";this.$message.error(t)}finally{this.isSubmitting=!1}},handleUploadSuccess(e){if(e&&e.raw)try{const t=URL.createObjectURL(e.raw),r={uid:e.uid,name:e.name,status:"ready",percentage:0,url:t,raw:e.raw};this.form.images=[...this.form.images,r]}catch(t){console.error("文件预览错误:",t),this.$message.error("不支持该文件类型")}else this.$message.error("文件加载异常")},beforeUpload(e){const t=["image/jpeg","image/png"].includes(e.type),r=e.size/1024/1024<5;return t?!!r||(this.$message.error("图片大小不能超过5MB"),!1):(this.$message.error("仅支持 JPG/PNG 格式"),!1)}}},l=o,n=r(1656),c=(0,n.A)(l,i,a,!1,null,"0231b4d4",null),m=c.exports},655:function(e,t,r){var i=r(6955),a=String;e.exports=function(e){if("Symbol"===i(e))throw new TypeError("Cannot convert a Symbol value to a string");return a(e)}},2812:function(e){var t=TypeError;e.exports=function(e,r){if(e<r)throw new t("Not enough arguments");return e}},4603:function(e,t,r){var i=r(6840),a=r(9504),s=r(655),o=r(2812),l=URLSearchParams,n=l.prototype,c=a(n.append),m=a(n["delete"]),u=a(n.forEach),d=a([].push),p=new l("a=1&a=2&b=3");p["delete"]("a",1),p["delete"]("b",void 0),p+""!=="a=2"&&i(n,"delete",(function(e){var t=arguments.length,r=t<2?void 0:arguments[1];if(t&&void 0===r)return m(this,e);var i=[];u(this,(function(e,t){d(i,{key:t,value:e})})),o(t,1);var a,l=s(e),n=s(r),p=0,f=0,g=!1,h=i.length;while(p<h)a=i[p++],g||a.key===l?(g=!0,m(this,a.key)):f++;while(f<h)a=i[f++],a.key===l&&a.value===n||c(this,a.key,a.value)}),{enumerable:!0,unsafe:!0})},7566:function(e,t,r){var i=r(6840),a=r(9504),s=r(655),o=r(2812),l=URLSearchParams,n=l.prototype,c=a(n.getAll),m=a(n.has),u=new l("a=1");!u.has("a",2)&&u.has("a",void 0)||i(n,"has",(function(e){var t=arguments.length,r=t<2?void 0:arguments[1];if(t&&void 0===r)return m(this,e);var i=c(this,e);o(t,1);var a=s(r),l=0;while(l<i.length)if(i[l++]===a)return!0;return!1}),{enumerable:!0,unsafe:!0})},7588:function(e,t,r){var i=r(6518),a=r(2652),s=r(9306),o=r(8551),l=r(1767);i({target:"Iterator",proto:!0,real:!0},{forEach:function(e){o(this),s(e);var t=l(this),r=0;a(t,(function(t){e(t,r++)}),{IS_RECORD:!0})}})},8721:function(e,t,r){var i=r(3724),a=r(9504),s=r(2106),o=URLSearchParams.prototype,l=a(o.forEach);i&&!("size"in o)&&s(o,"size",{get:function(){var e=0;return l(this,(function(){e++})),e},configurable:!0,enumerable:!0})}}]);
//# sourceMappingURL=273.08a39967.chunk.js.map