"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[423],{713:function(t,e,s){var a=s(9565),r=s(9306),i=s(8551),n=s(1767),o=s(9462),l=s(6319),c=o((function(){var t=this.iterator,e=i(a(this.next,t)),s=this.done=!!e.done;if(!s)return l(t,this.mapper,[e.value,this.counter++],!0)}));t.exports=function(t){return i(this),r(t),new c(n(this),{mapper:t})}},1701:function(t,e,s){var a=s(6518),r=s(713),i=s(6395);a({target:"Iterator",proto:!0,real:!0,forced:i},{map:r})},2529:function(t){t.exports=function(t,e){return{value:t,done:e}}},6279:function(t,e,s){var a=s(6840);t.exports=function(t,e,s){for(var r in e)a(t,r,e[r],s);return t}},6319:function(t,e,s){var a=s(8551),r=s(9539);t.exports=function(t,e,s,i){try{return i?e(a(s)[0],s[1]):e(s)}catch(n){r(t,"throw",n)}}},6423:function(t,e,s){s.r(e),s.d(e,{default:function(){return m}});s(4114);var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"admin-dashboard"},[e("div",{staticClass:"dashboard-header"},[e("div",{staticClass:"header-content"},[e("div",[e("h1",{staticClass:"welcome-title"},[t._v("æ¬¢è¿å›æ¥ï¼Œ"+t._s(t.user.real_name)+"ï¼ğŸ‘‹")])]),e("el-button",{staticClass:"logout-btn",attrs:{type:"danger",plain:"",icon:"el-icon-switch-button"},on:{click:t.handleLogout}},[t._v(" é€€å‡ºç™»å½• ")])],1),e("p",{staticClass:"welcome-sub"},[t._v("ä»Šæ—¥æœ‰ "+t._s(t.pendingCount)+" é¡¹å¾…å¤„ç†äº‹åŠ¡")])]),e("el-row",{staticClass:"metric-grid",attrs:{gutter:24}},[e("el-col",{attrs:{xs:24,sm:12,lg:8}},[e("el-card",{staticClass:"metric-card metric-pending",attrs:{shadow:"hover"}},[e("div",{staticClass:"metric-content"},[e("div",{staticClass:"metric-icon"},[e("i",{staticClass:"el-icon-time"})]),e("div",{staticClass:"metric-info"},[e("span",{staticClass:"metric-label"},[t._v("å¾…å®¡æ ¸")]),e("span",{staticClass:"metric-value"},[t._v(t._s(t.pendingCount))])])])])],1),e("el-col",{attrs:{xs:24,sm:12,lg:8}},[e("el-card",{staticClass:"metric-card metric-active",attrs:{shadow:"hover"}},[e("div",{staticClass:"metric-content"},[e("div",{staticClass:"metric-icon"},[e("i",{staticClass:"el-icon-loading"})]),e("div",{staticClass:"metric-info"},[e("span",{staticClass:"metric-label"},[t._v("è¿›è¡Œä¸­")]),e("span",{staticClass:"metric-value"},[t._v(t._s(t.activeCount))])])])])],1),e("el-col",{attrs:{xs:24,sm:12,lg:8}},[e("el-card",{staticClass:"metric-card metric-completed",attrs:{shadow:"hover"}},[e("div",{staticClass:"metric-content"},[e("div",{staticClass:"metric-icon"},[e("i",{staticClass:"el-icon-success"})]),e("div",{staticClass:"metric-info"},[e("span",{staticClass:"metric-label"},[t._v("å·²å®Œæˆ")]),e("span",{staticClass:"metric-value"},[t._v(t._s(t.completedCount))])])])])],1)],1),e("el-row",{staticClass:"data-grid",attrs:{gutter:24}},[e("el-col",{attrs:{xs:24,lg:12}},[e("el-card",{staticClass:"data-card",attrs:{shadow:"never"},scopedSlots:t._u([{key:"header",fn:function(){return[e("div",{staticClass:"card-header"},[e("div",{staticClass:"header-title"},[e("i",{staticClass:"el-icon-box"}),e("span",[t._v("æœ€æ–°å¤±ç‰©ä¿¡æ¯")])]),e("el-button",{staticClass:"view-more",attrs:{type:"text"},on:{click:function(e){return t.$router.push("/admin/found-items")}}},[t._v(" ç®¡ç†å…¨éƒ¨ "),e("i",{staticClass:"el-icon-arrow-right"})])],1)]},proxy:!0}])},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading.posts,expression:"loading.posts"}],staticClass:"data-table",attrs:{data:t.recentPosts,"empty-text":"æš‚æ— å¾…å¤„ç†ä¿¡æ¯","header-cell-style":{background:"#f8f9fa"}},on:{"row-click":t.handleRowClick},scopedSlots:t._u([{key:"empty",fn:function(){return[e("div",{staticClass:"empty-state"},[e("i",{staticClass:"el-icon-document-remove"}),e("span",[t._v("å½“å‰æ²¡æœ‰å¯æ˜¾ç¤ºçš„å¤±ç‰©ä¿¡æ¯")])])]},proxy:!0}])},[e("el-table-column",{attrs:{prop:"title",label:"ç‰©å“åç§°","min-width":"180"},scopedSlots:t._u([{key:"default",fn:function({row:s}){return[e("span",{staticClass:"text-ellipsis"},[t._v(t._s(s.title))])]}}])}),e("el-table-column",{attrs:{label:"ç±»å‹",width:"100"},scopedSlots:t._u([{key:"default",fn:function({row:e}){return[t._v(" "+t._s(t.getItemTypeLabel(e.item_type))+" ")]}}])}),e("el-table-column",{attrs:{prop:"category",label:"åˆ†ç±»",width:"120"},scopedSlots:t._u([{key:"default",fn:function({row:s}){return[e("el-tag",{attrs:{effect:"plain"}},[t._v(t._s(s.category))])]}}])}),e("el-table-column",{attrs:{label:"çŠ¶æ€",width:"100",align:"center"},scopedSlots:t._u([{key:"default",fn:function({row:s}){return[e("el-tag",{staticClass:"status-tag",attrs:{type:t.statusTypeMap[s.status],effect:"light"}},[t._v(" "+t._s(s.status)+" ")])]}}])})],1)],1)],1),e("el-col",{attrs:{xs:24,lg:12}},[e("el-card",{staticClass:"data-card",attrs:{shadow:"never"},scopedSlots:t._u([{key:"header",fn:function(){return[e("div",{staticClass:"card-header"},[e("div",{staticClass:"header-title"},[e("i",{staticClass:"el-icon-user"}),e("span",[t._v("æ–°å¢ç”¨æˆ·")])]),e("el-button",{staticClass:"view-more",attrs:{type:"text"},on:{click:function(e){return t.$router.push("/admin/users")}}},[t._v(" ç®¡ç†å…¨éƒ¨ "),e("i",{staticClass:"el-icon-arrow-right"})])],1)]},proxy:!0}])},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading.users,expression:"loading.users"}],staticClass:"data-table",attrs:{data:t.recentUsers,"header-cell-style":{background:"#f8f9fa"}},on:{"row-click":t.handleUserRowClick}},[e("el-table-column",{attrs:{prop:"username",label:"å­¦å·¥å·","min-width":"120"},scopedSlots:t._u([{key:"default",fn:function({row:s}){return[e("div",{staticClass:"user-cell"},[e("el-avatar",{attrs:{size:24,src:s.avatar||t.defaultAvatar}},[t._v(" "+t._s(s.real_name?.charAt(0)||"?")+" ")]),e("span",[t._v(t._s(s.username||"æ— æ•°æ®"))])],1)]}}])}),e("el-table-column",{attrs:{prop:"real_name",label:"å§“å",width:"100"}}),e("el-table-column",{attrs:{prop:"role",label:"è§’è‰²",width:"100"},scopedSlots:t._u([{key:"default",fn:function({row:s}){return[e("el-tag",{staticClass:"role-tag",attrs:{type:t.roleTagType(s.role),effect:"light"}},[t._v(" "+t._s(s.role)+" ")])]}}])})],1)],1)],1)],1),e("el-dialog",{staticClass:"admin-detail-dialog",attrs:{title:"ğŸ“¦ ç‰©å“è¯¦æƒ…",visible:t.itemDialogVisible,width:"800px"},on:{"update:visible":function(e){t.itemDialogVisible=e}}},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:8}},[e("el-carousel",{attrs:{interval:5e3,height:"300px",arrow:"always"}},t._l(t.currentItem.images,(function(s,a){return e("el-carousel-item",{key:a},[e("el-image",{staticClass:"detail-image",attrs:{src:s,"preview-src-list":t.currentItem.images,fit:"cover"}},[e("div",{staticClass:"image-error",attrs:{slot:"error"},slot:"error"},[e("i",{staticClass:"el-icon-picture-outline"})])])],1)})),1)],1),e("el-col",{attrs:{span:16}},[e("el-descriptions",{attrs:{column:2,border:"","label-class-name":"detail-label"}},[e("el-descriptions-item",{attrs:{label:"ç‰©å“åç§°"}},[t._v(t._s(t.currentItem.title))]),e("el-descriptions-item",{attrs:{label:"åˆ†ç±»"}},[t._v(t._s(t.currentItem.category))]),e("el-descriptions-item",{attrs:{label:"å‘å¸ƒç±»å‹"}},[t._v(" "+t._s("lost"===t.currentItem.item_type?"å¤±ç‰©ç™»è®°":"æ‹›é¢†ç™»è®°")+" ")]),e("el-descriptions-item",{attrs:{label:"ä¸¢å¤±æ—¶é—´"}},[t._v(t._s(t.formatTime(t.currentItem.lost_time)))]),e("el-descriptions-item",{attrs:{label:"ä¸¢å¤±åœ°ç‚¹"}},[t._v(t._s(t.currentItem.location))]),e("el-descriptions-item",{attrs:{label:"æäº¤äºº"}},["admin"===t.currentItem.user?.role?e("el-tooltip",{attrs:{content:"ç®¡ç†å‘˜è´¦å·"}},[e("i",{staticClass:"el-icon-s-custom"})]):t._e(),t._v(" "+t._s(t.currentItem.user?.real_name||"åŒ¿åç”¨æˆ·")+" "),t.currentItem.user?e("span",{staticClass:"user-role-tag"},[t._v(" ("+t._s(t.roleMap[t.currentItem.user.role])+") ")]):t._e()],1),e("el-descriptions-item",{attrs:{label:"çŠ¶æ€"}},[e("el-tag",{attrs:{type:t.statusTypeMap[t.currentItem.status]}},[t._v(t._s(t.currentItem.status))])],1),e("el-descriptions-item",{attrs:{label:"è”ç³»æ–¹å¼",span:2}},[e("el-link",{attrs:{type:"primary"}},[t._v(t._s(t.currentItem.contact))])],1),e("el-descriptions-item",{attrs:{label:"è¯¦ç»†æè¿°",span:2}},[e("pre",{staticClass:"description-pre"},[t._v(t._s(t.currentItem.description))])])],1)],1)],1),e("div",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.itemDialogVisible=!1}}},[t._v("å…³é—­")]),"pending"===t.currentItem.status?e("el-button",{attrs:{type:"success",disabled:!t.currentItem.id||t.approvalProcessing,loading:t.approvalProcessing},on:{click:t.handleApproveItem}},[t._v(" "+t._s(t.approvalProcessing?"æ­£åœ¨å¤„ç†...":"å®¡æ ¸é€šè¿‡")+" ")]):t._e()],1)],1),e("el-dialog",{staticClass:"admin-detail-dialog",attrs:{title:"ğŸ‘¤ ç”¨æˆ·è¯¦æƒ…",visible:t.userDialogVisible,width:"600px"},on:{"update:visible":function(e){t.userDialogVisible=e}}},[e("el-descriptions",{attrs:{column:2,border:""}},[e("el-descriptions-item",{attrs:{label:"ç”¨æˆ·ID"}},[t._v(t._s(t.currentUser.id))]),e("el-descriptions-item",{attrs:{label:"ç”¨æˆ·å"}},[t._v(t._s(t.currentUser.username))]),e("el-descriptions-item",{attrs:{label:"çœŸå®å§“å"}},[t._v(t._s(t.currentUser.real_name))]),e("el-descriptions-item",{attrs:{label:"ç”¨æˆ·è§’è‰²"}},[e("el-tag",{attrs:{type:t.roleTagType(t.currentUser.role)}},[t._v(t._s(t.currentUser.role))])],1),e("el-descriptions-item",{attrs:{label:"æ³¨å†Œæ—¶é—´"}},[t._v(t._s(t.currentUser.date_joined))]),e("el-descriptions-item",{attrs:{label:"æœ€åç™»å½•"}},[t._v(t._s(t.currentUser.last_login))]),e("el-descriptions-item",{attrs:{label:"è”ç³»æ–¹å¼"}},[t._v(t._s(t.currentUser.phone))]),e("el-descriptions-item",{attrs:{label:"ç”µå­é‚®ç®±"}},[t._v(t._s(t.currentUser.email))])],1)],1)],1)},r=[],i=(s(8111),s(7588),s(1701),s(4335)),n=s(4353),o=s.n(n),l={data(){return{user:{real_name:"åŠ è½½ä¸­...",avatar:s(7799),role:"",phone:""},defaultAvatar:s(7799),pendingCount:0,activeCount:0,completedCount:0,recentPosts:[],recentUsers:[],loading:{posts:!0,users:!0},statusTypeMap:{pending:"warning",active:"primary",completed:"success",expired:"info"},itemDialogVisible:!1,userDialogVisible:!1,currentItem:{},currentUser:{}}},computed:{roleMap(){return{admin:"ç®¡ç†å‘˜",teacher:"æ•™èŒå·¥",student:"å­¦ç”Ÿ"}}},mounted(){this.fetchAdminData(),this.$nextTick((()=>{const t=new MutationObserver((()=>{const t=document.querySelectorAll(".el-loading-mask");t.forEach((t=>{"none"!==t.style.display&&setTimeout((()=>t.style.display="none"),5e3)}))}));t.observe(this.$el,{childList:!0,subtree:!0})}))},methods:{getItemTypeLabel(t){return"lost"===t?"å¤±ç‰©":"æ‹›é¢†"},getCategoryName(t){return i.A.get(`/api/category/name/${t}/`).then((t=>t.data.name)).catch((()=>"æœªçŸ¥åˆ†ç±»"))},formatTime(t){return o()(t).format("YYYY-MM-DD HH:mm")},handleLogout(){this.$confirm("ç¡®å®šè¦é€€å‡ºç³»ç»Ÿå—ï¼Ÿ","æ“ä½œç¡®è®¤",{type:"warning",confirmButtonText:"ç¡®è®¤é€€å‡º",cancelButtonText:"å–æ¶ˆ"}).then((()=>{this.$store.dispatch("logout"),this.$router.replace("/login"),this.$message.success("å·²å®‰å…¨é€€å‡ºç³»ç»Ÿ")})).catch((()=>{}))},roleTagType(t){const e={admin:"danger",teacher:"warning",student:"success"};return e[t]||"info"},async fetchAdminData(){try{this.loading={posts:!0,users:!0};const t={headers:{Authorization:`Token ${localStorage.getItem("token")}`}},[e,s,a,r]=await Promise.all([i.A.get("/api/user/profile/",t),i.A.get("/api/admin/stats/",t),i.A.get("/api/admin/recent-posts/",t),i.A.get("/api/admin/recent-users/",t)]);this.user=e.data,this.pendingCount=s.data.pending_count,this.activeCount=s.data.active_count,this.completedCount=s.data.completed_count,this.recentPosts=a.data.recent_posts,this.recentUsers=r.data.recent_users}catch(t){console.error("Error:",t),this.$message.error(t.response?.data?.message||"æ•°æ®åŠ è½½å¤±è´¥")}finally{this.loading={posts:!1,users:!1}}},async handleRowClick(t){try{const e=`/api/admin/found-items/${t.id}/`,s=await i.A.get(e,{headers:{Authorization:`Token ${localStorage.getItem("token")}`}}),a=await this.getCategoryName(s.data.category);this.currentItem={...s.data,category:a,images:s.data.images||[],user:s.data.user||{}},this.itemDialogVisible=!0}catch(e){this.$message.error("è·å–è¯¦æƒ…å¤±è´¥")}},async handleUserRowClick(t){try{const e=await i.A.get(`/api/admin/users/${t.id}/`,{headers:{Authorization:`Token ${localStorage.getItem("token")}`}});this.currentUser=e.data,this.userDialogVisible=!0,this.currentUser.date_joined=new Date(this.currentUser.date_joined).toLocaleString(),this.currentUser.last_login=this.currentUser.last_login?new Date(this.currentUser.last_login).toLocaleString():"ä»æœªç™»å½•"}catch(e){this.$message.error("è·å–ç”¨æˆ·è¯¦æƒ…å¤±è´¥"),console.error("Error fetching user details:",e)}},async handleApproveItem(){try{if("pending"!==this.currentItem.status)throw new Error("åªèƒ½å®¡æ ¸å¾…å¤„ç†çŠ¶æ€çš„ç‰©å“");await this.$confirm("ç¡®å®šè¦é€šè¿‡è¯¥ç‰©å“çš„å®¡æ ¸å—ï¼Ÿ","æ“ä½œç¡®è®¤",{confirmButtonClass:"el-button--danger"});const t=Date.now();await this.$http.patch(`/admin/items/${this.currentItem.id}/status/`,{status:"active",admin_remark:"å·²é€šè¿‡å®¡æ ¸"},{headers:{"X-Request-ID":`approve-req-${this.currentItem.id}-${Date.now()}`,"Content-Type":"application/json-patch+json"}}),this.currentItem={...this.currentItem,status:"active",admin_remark:"å·²é€šè¿‡å®¡æ ¸"},this.pendingCount--,this.activeCount++,this.recentPosts=this.recentPosts.map((t=>t.id===this.currentItem.id?{...t,status:"active"}:t)),console.log(`å®¡æ ¸æ“ä½œè€—æ—¶ ${Date.now()-t}ms`),this.$message.success(`${this.currentItem.title} å®¡æ ¸é€šè¿‡`)}catch(t){const e="cancel"===t,s=e?"æ“ä½œå·²å–æ¶ˆ":t.response?.data?.error||`å®¡æ ¸å¤±è´¥: ${t.message}`;!e&&console.error("å®¡æ ¸é”™è¯¯è¯¦æƒ…:",{error:t.response?.data,item:this.currentItem}),this.$message[e?"info":"error"](s)}}}},c=l,u=s(1656),d=(0,u.A)(c,a,r,!1,null,"1d96f349",null),m=d.exports},7588:function(t,e,s){var a=s(6518),r=s(2652),i=s(9306),n=s(8551),o=s(1767);a({target:"Iterator",proto:!0,real:!0},{forEach:function(t){n(this),i(t);var e=o(this),s=0;r(e,(function(e){t(e,s++)}),{IS_RECORD:!0})}})},7799:function(t,e,s){t.exports=s.p+"img/touxiang.bf860c0f.jpg"},9462:function(t,e,s){var a=s(9565),r=s(2360),i=s(6699),n=s(6279),o=s(8227),l=s(1181),c=s(5966),u=s(7657).IteratorPrototype,d=s(2529),m=s(9539),p=o("toStringTag"),h="IteratorHelper",g="WrapForValidIterator",v=l.set,_=function(t){var e=l.getterFor(t?g:h);return n(r(u),{next:function(){var s=e(this);if(t)return s.nextHandler();if(s.done)return d(void 0,!0);try{var a=s.nextHandler();return s.returnHandlerResult?a:d(a,s.done)}catch(r){throw s.done=!0,r}},return:function(){var s=e(this),r=s.iterator;if(s.done=!0,t){var i=c(r,"return");return i?a(i,r):d(void 0,!0)}if(s.inner)try{m(s.inner.iterator,"normal")}catch(n){return m(r,"throw",n)}return r&&m(r,"normal"),d(void 0,!0)}})},f=_(!0),C=_(!1);i(C,p,"Iterator Helper"),t.exports=function(t,e,s){var a=function(a,r){r?(r.iterator=a.iterator,r.next=a.next):r=a,r.type=e?g:h,r.returnHandlerResult=!!s,r.nextHandler=t,r.counter=0,r.done=!1,v(this,r)};return a.prototype=e?f:C,a}}}]);
//# sourceMappingURL=423.2e51220c.chunk.js.map