"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[493],{116:function(t,e,a){var s=a(6518),i=a(2652),r=a(9306),o=a(8551),l=a(1767);s({target:"Iterator",proto:!0,real:!0},{find:function(t){o(this),r(t);var e=l(this),a=0;return i(e,(function(e,s){if(t(e,a++))return s(e)}),{IS_RECORD:!0,INTERRUPTED:!0}).result}})},2493:function(t,e,a){a.r(e),a.d(e,{default:function(){return m}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"lost-item-hall"},[e("h1",[t._v("🔍 失物大厅")]),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{data:t.lostItems,"header-cell-style":{background:"#f8f9fa"}},scopedSlots:t._u([{key:"empty",fn:function(){return[e("div",{staticClass:"empty-state"},[e("i",{staticClass:"el-icon-document-remove"}),e("span",[t._v("当前没有可显示的失物信息")])])]},proxy:!0}])},[e("el-table-column",{attrs:{prop:"title",label:"物品名称","min-width":"180"},scopedSlots:t._u([{key:"default",fn:function({row:a}){return[e("span",{staticClass:"text-ellipsis"},[t._v(t._s(a.title))])]}}])}),e("el-table-column",{attrs:{label:"类型",width:"100"},scopedSlots:t._u([{key:"default",fn:function({row:e}){return[t._v(" "+t._s(t.getItemTypeLabel(e.item_type))+" ")]}}])}),e("el-table-column",{attrs:{prop:"category",label:"分类",width:"120"},scopedSlots:t._u([{key:"default",fn:function({row:a}){return[e("el-tag",{attrs:{effect:"plain"}},[t._v(t._s(a.category_name))])]}}])}),e("el-table-column",{attrs:{label:"丢失时间",width:"150"},scopedSlots:t._u([{key:"default",fn:function({row:e}){return[t._v(" "+t._s(t.formatTime(e.lost_time))+" ")]}}])}),e("el-table-column",{attrs:{label:"丢失地点",width:"200"},scopedSlots:t._u([{key:"default",fn:function({row:e}){return[t._v(" "+t._s(e.location)+" ")]}}])}),e("el-table-column",{attrs:{label:"状态",width:"100",align:"center"},scopedSlots:t._u([{key:"default",fn:function({row:a}){return[e("el-tag",{staticClass:"status-tag",attrs:{type:t.statusTypeMap[a.status],effect:"light"}},[t._v(" "+t._s(a.status)+" ")])]}}])}),e("el-table-column",{attrs:{label:"操作",width:"100"},scopedSlots:t._u([{key:"default",fn:function({row:a}){return[e("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.viewDetails(a)}}},[t._v("查看详情")])]}}])})],1),e("el-dialog",{attrs:{title:"🔍 物品详情",visible:t.detailDialogVisible,width:"800px","custom-class":"item-detail-dialog"},on:{"update:visible":function(e){t.detailDialogVisible=e}}},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:8}},[e("el-carousel",{attrs:{interval:5e3,height:"300px",arrow:"always"}},t._l(t.currentItem.images,(function(t,a){return e("el-carousel-item",{key:a},[e("el-image",{staticClass:"detail-image",attrs:{src:t,fit:"cover"}},[e("div",{staticClass:"image-error",attrs:{slot:"error"},slot:"error"},[e("i",{staticClass:"el-icon-picture-outline"})])])],1)})),1)],1),e("el-col",{attrs:{span:16}},[e("el-descriptions",{attrs:{column:2,border:"","label-class-name":"detail-label"}},[e("el-descriptions-item",{attrs:{label:"物品名称"}},[t._v(t._s(t.currentItem.title))]),e("el-descriptions-item",{attrs:{label:"物品分类"}},[t._v(" "+t._s(t.currentItem.category_name)+" ")]),e("el-descriptions-item",{attrs:{label:"提交人"}},["admin"===t.currentItem.user?.role?e("el-tooltip",{attrs:{content:"管理员账号"}},[e("i",{staticClass:"el-icon-s-custom"})]):t._e(),t._v(" "+t._s(t.currentItem.user?.real_name||"匿名用户")+" "),t.currentItem.user?e("span",{staticClass:"user-role-tag"},[t._v(" ("+t._s(t.roleMap[t.currentItem.user.role])+") ")]):t._e()],1),e("el-descriptions-item",{attrs:{label:"丢失时间"}},[t._v(" "+t._s(t.formatTime(t.currentItem.lost_time))+" ")]),e("el-descriptions-item",{attrs:{label:"丢失地点"}},[t._v(" "+t._s(t.currentItem.location)+" "),t.currentItem.location_lat&&t.currentItem.location_lng?e("div",{staticClass:"detail-map-container",attrs:{id:"detail-map-"+t.currentItem.id}}):t._e()]),e("el-descriptions-item",{attrs:{label:"发布类型"}},[t._v(" "+t._s("lost"===t.currentItem.item_type?"失物登记":"招领登记")+" ")]),e("el-descriptions-item",{attrs:{label:"当前状态"}},[e("el-tag",{attrs:{type:t.statusTypeMap[t.currentItem.status],size:"medium"}},[t._v(" "+t._s(t.statusTextMap[t.currentItem.status])+" ")])],1),e("el-descriptions-item",{attrs:{label:"登记时间"}},[t._v(" "+t._s(t.formatTime(t.currentItem.created_at))+" ")]),e("el-descriptions-item",{attrs:{label:"详细描述",span:2}},[e("pre",{staticClass:"description-pre"},[t._v(t._s(t.currentItem.description))])])],1)],1)],1),e("span",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:t.bookmarked?"success":"primary",icon:t.bookmarked?"el-icon-star-off":"el-icon-star-on"},on:{click:t.handleBookmark}},[t._v(" "+t._s(t.bookmarked?"已收藏":"收藏物品")+" ")]),e("el-button",{on:{click:function(e){t.detailDialogVisible=!1}}},[t._v("关闭")])],1)],1)],1)},i=[],r=(a(8111),a(116),a(4335)),o=a(4353),l=a.n(o),n={data(){return{lostItems:[],loading:!1,detailDialogVisible:!1,currentItem:{},statusTypeMap:{pending:"warning",active:"primary",completed:"success",expired:"info"},statusTextMap:{pending:"待审核",active:"进行中",completed:"已完成",expired:"已过期"},bookmarked:!1}},methods:{getItemTypeLabel(t){return"lost"===t?"失物登记":"招领登记"},formatTime(t){return l()(t).format("YYYY-MM-DD HH:mm:ss")},async fetchLostItems(){this.loading=!0;try{const t=await r.A.get("/api/public/lost-items/");this.lostItems=t.data}catch(t){console.error("获取失物信息失败",t)}finally{this.loading=!1}},async checkBookmarkStatus(){try{const t=await r.A.get(`/api/bookmarks/${this.currentItem.id}/`,{headers:{Authorization:`Token ${this.$store.state.token}`,"X-CSRFToken":this.getCSRFToken()}});this.bookmarked=t.data.bookmarked}catch(t){console.error("获取收藏状态失败",t)}},getCSRFToken(){const t=document.cookie.split("; ").find((t=>t.startsWith("csrftoken=")))?.split("=")[1]||"";return t},async handleBookmark(){try{const t={headers:{Authorization:`Token ${this.$store.state.token}`,"X-CSRFToken":this.getCSRFToken(),"Content-Type":"application/json"}},e=this.bookmarked?"delete":"post";await r.A[e](`/api/bookmarks/${this.currentItem.id}/`,"delete"===e?t:null,"post"===e?t:null),this.bookmarked=!this.bookmarked,this.$message.success(this.bookmarked?"收藏成功":"已取消收藏")}catch(t){console.error("操作收藏失败",t),this.$message.error(`操作失败: ${t.response?.data?.error||"未知错误"}`)}},viewDetails(t){this.$store.state.token?(this.currentItem=t,this.detailDialogVisible=!0,this.checkBookmarkStatus()):this.$message.warning("请先登录")},initDetailMap(){if(!window.AMap)return void this.$message.warning("地图资源正在加载，请稍候");const t=parseFloat(this.currentItem.location_lng),e=parseFloat(this.currentItem.location_lat);if(isNaN(t)||isNaN(e))return;this.destroyDetailMap();const a=`detail-map-${this.currentItem.id}`,s=document.getElementById(a);if(!s)return;this.detailMap=new AMap.Map(a,{zoom:17,center:[t,e],resizeEnable:!0});const i=new AMap.Scale,r=new AMap.ToolBar({position:{bottom:"20px",right:"20px"}});i.addTo(this.detailMap),r.addTo(this.detailMap),new AMap.Marker({position:[t,e],content:'<div class="location-pin">📍</div>',map:this.detailMap})},destroyDetailMap(){if(this.detailMap){try{this.detailMap.destroy()}catch(t){console.warn("地图销毁过程中出现警告:",t.message)}this.detailMap=null}}},mounted(){if(this.fetchLostItems(),!window.AMap){const t="db70318a1cf1f196b2746f10cb9df826",e=["AMap.Scale","AMap.ToolBar"].join(","),a=document.createElement("script");a.src=`https://webapi.amap.com/maps?v=2.0&key=${t}&plugin=${e}`,a.onerror=()=>{console.error("高德地图SDK加载失败")},document.head.appendChild(a)}},computed:{roleMap(){return{admin:"管理员",teacher:"教职工",student:"学生"}}},watch:{detailDialogVisible(t){t?this.$nextTick((()=>{this.currentItem.location_lat&&this.currentItem.location_lng&&this.initDetailMap()})):this.destroyDetailMap()}}},c=n,u=a(1656),d=(0,u.A)(c,s,i,!1,null,"15732817",null),m=d.exports}}]);
//# sourceMappingURL=493.c1688503.chunk.js.map