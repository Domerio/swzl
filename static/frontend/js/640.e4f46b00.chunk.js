"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[640],{7588:function(e,r,s){var t=s(6518),a=s(2652),o=s(9306),i=s(8551),l=s(1767);t({target:"Iterator",proto:!0,real:!0},{forEach:function(e){i(this),o(e);var r=l(this),s=0;a(r,(function(r){e(r,s++)}),{IS_RECORD:!0})}})},8640:function(e,r,s){s.r(r),s.d(r,{default:function(){return m}});var t=function(){var e=this,r=e._self._c;return r("div",{staticClass:"login-container"},[r("el-card",{staticClass:"login-card"},[r("div",{staticClass:"title"},[e._v("校园失物招领系统")]),r("el-tabs",{model:{value:e.activeTab,callback:function(r){e.activeTab=r},expression:"activeTab"}},[r("el-tab-pane",{attrs:{label:"登录",name:"login"}},[r("el-form",{ref:"loginForm",attrs:{model:e.loginForm,rules:e.loginRules}},[r("el-form-item",{attrs:{prop:"username"}},[r("el-input",{attrs:{placeholder:"学号/工号"},model:{value:e.loginForm.username,callback:function(r){e.$set(e.loginForm,"username",r)},expression:"loginForm.username"}},[r("i",{staticClass:"el-input__icon el-icon-user",attrs:{slot:"prefix"},slot:"prefix"})])],1),r("el-form-item",{attrs:{prop:"password"}},[r("el-input",{attrs:{type:"password",placeholder:"密码","show-password":""},model:{value:e.loginForm.password,callback:function(r){e.$set(e.loginForm,"password",r)},expression:"loginForm.password"}},[r("i",{staticClass:"el-input__icon el-icon-lock",attrs:{slot:"prefix"},slot:"prefix"})])],1),r("el-form-item",[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:e.handleLogin}},[e._v(" 登录 ")])],1)],1)],1),r("el-tab-pane",{attrs:{label:"注册",name:"register"}},[r("el-form",{ref:"registerForm",attrs:{model:e.registerForm,rules:e.registerRules}},[r("el-form-item",{attrs:{prop:"username"}},[r("el-input",{attrs:{placeholder:"学号/工号"},model:{value:e.registerForm.username,callback:function(r){e.$set(e.registerForm,"username",r)},expression:"registerForm.username"}},[r("i",{staticClass:"el-input__icon el-icon-user",attrs:{slot:"prefix"},slot:"prefix"})])],1),r("el-form-item",{attrs:{prop:"name"}},[r("el-input",{attrs:{placeholder:"真实姓名"},model:{value:e.registerForm.real_name,callback:function(r){e.$set(e.registerForm,"real_name",r)},expression:"registerForm.real_name"}},[r("i",{staticClass:"el-input__icon el-icon-user",attrs:{slot:"prefix"},slot:"prefix"})])],1),r("el-form-item",{attrs:{prop:"password"}},[r("el-input",{attrs:{type:"password",placeholder:"密码","show-password":""},model:{value:e.registerForm.password,callback:function(r){e.$set(e.registerForm,"password",r)},expression:"registerForm.password"}},[r("i",{staticClass:"el-input__icon el-icon-lock",attrs:{slot:"prefix"},slot:"prefix"})])],1),r("el-form-item",{attrs:{prop:"confirmPassword"}},[r("el-input",{attrs:{type:"password",placeholder:"确认密码","show-password":""},model:{value:e.registerForm.confirmPassword,callback:function(r){e.$set(e.registerForm,"confirmPassword",r)},expression:"registerForm.confirmPassword"}},[r("i",{staticClass:"el-input__icon el-icon-lock",attrs:{slot:"prefix"},slot:"prefix"})])],1),r("el-form-item",{attrs:{prop:"role"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择身份"},model:{value:e.registerForm.role,callback:function(r){e.$set(e.registerForm,"role",r)},expression:"registerForm.role"}},[r("el-option",{attrs:{label:"学生",value:"student"}}),r("el-option",{attrs:{label:"教职工",value:"staff"}})],1)],1),r("el-form-item",[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:e.handleRegister}},[e._v(" 注册 ")])],1)],1)],1)],1)],1)],1)},a=[],o=(s(8111),s(7588),{name:"UserLogin",data(){const e=(e,r,s)=>{r!==this.registerForm.password?s(new Error("两次输入的密码不一致")):s()};return{activeTab:"login",loginForm:{username:"",password:""},registerForm:{username:"",real_name:"",password:"",confirm_Password:"",role:"",csrfToken:""},loginRules:{username:[{required:!0,message:"请输入学号/工号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},registerRules:{username:[{required:!0,message:"请输入学号/工号",trigger:"blur"}],real_name:[{required:!0,message:"请输入姓名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能小于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:e,trigger:"blur"}],role:[{required:!0,message:"请选择身份",trigger:"change"}]}}},methods:{async handleLogin(){try{await this.$refs.loginForm.validate();const e=await this.$http({url:"/login/",method:"post",data:{username:this.loginForm.username,password:this.loginForm.password}});await this.$store.dispatch("login",{token:e.token,user:{id:e.user_id,username:e.username,role:e.role,name:e.real_name||e.name}}),this.$message.success("登录成功");const r={student:"/student-dashboard",staff:"/staff-dashboard",admin:"/admin-dashboard"},s=this.$route.query.redirect||r[e.role]||"/";this.$router.replace(s).catch((s=>{"NavigationDuplicated"!==s.name&&(console.error("Navigation error:",s),this.$router.replace(r[e.role]||"/"))}))}catch(e){console.error("Login error:",e);const r=e.response?.data?.error||e.response?.data?.message||"登录失败，请检查用户名和密码";this.$message.error(r)}},handleRegister:async function(){try{await this.$refs.registerForm.validate();const e=await this.$http.get("/csrf-token/"),r={username:this.registerForm.username,password:this.registerForm.password,confirm_password:this.registerForm.confirmPassword,real_name:this.registerForm.real_name,role:this.registerForm.role,csrfToken:e};console.log("Sending registration data:",r);const s=await this.$http({url:"/register/",method:"post",data:r});this.$message.success(s.message||"注册成功"),await this.$nextTick(),await this.$store.dispatch("login",{token:s.token,user:{id:s.user_id,username:s.username,role:s.role,name:s.real_name||s.name}}),await this.$nextTick();const t={student:"/student-dashboard",staff:"/staff-dashboard",admin:"/admin-dashboard"};this.$router.replace(t[s.role]||"/").catch((e=>{"NavigationDuplicated"!==e.name&&console.error("Navigation error:",e)})),this.$message.success(s.message||"登录成功")}catch(e){if(console.error("Register error:",e),e.response&&e.response.data){const r=e.response.data.error;"object"===typeof r?Object.keys(r).forEach((e=>{this.$message.error(`${e}: ${r[e]}`)})):this.$message.error(r||"注册失败，请重试")}else this.$message.error("注册失败，请重试")}}}}),i=o,l=s(1656),n=(0,l.A)(i,t,a,!1,null,"b8a09fca",null),m=n.exports}}]);
//# sourceMappingURL=640.e4f46b00.chunk.js.map