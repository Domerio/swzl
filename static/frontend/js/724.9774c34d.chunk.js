"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[724],{8724:function(e,t,r){r.r(t),r.d(t,{default:function(){return c}});var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"lost-item-register"},[t("h1",[e._v("失物登记")]),t("el-form",{ref:"formRef",attrs:{model:e.form,"label-width":"120px",rules:e.rules}},[t("el-form-item",{attrs:{label:"标题",prop:"title"}},[t("el-input",{model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),t("el-form-item",{attrs:{label:"详细描述",prop:"description"}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),t("el-form-item",{attrs:{label:"丢失时间",prop:"lost_time"}},[t("el-date-picker",{attrs:{type:"datetime",placeholder:"选择丢失时间"},model:{value:e.form.lost_time,callback:function(t){e.$set(e.form,"lost_time",t)},expression:"form.lost_time"}})],1),t("el-form-item",{attrs:{label:"地点",prop:"location"}},[t("el-input",{model:{value:e.form.location,callback:function(t){e.$set(e.form,"location",t)},expression:"form.location"}})],1),t("el-form-item",{attrs:{label:"物品分类",prop:"category"}},[t("el-select",{attrs:{placeholder:"请选择物品分类"},model:{value:e.form.category,callback:function(t){e.$set(e.form,"category",t)},expression:"form.category"}},e._l(e.categories,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"联系方式",prop:"contact"}},[t("el-input",{model:{value:e.form.contact,callback:function(t){e.$set(e.form,"contact",t)},expression:"form.contact"}})],1),t("el-form-item",{attrs:{label:"物品图片"}},[t("el-upload",{attrs:{action:"/api/upload/",multiple:!0,"on-success":e.handleUploadSuccess,"before-upload":e.beforeUpload,"file-list":e.fileList,disabled:e.isSubmitting}},[t("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")])],1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",loading:e.isSubmitting},on:{click:e.submitForm}},[e._v(" 提交 ")])],1)],1)],1)},i=[],a=(r(4114),r(4335)),s={data(){return{form:{title:"",description:"",lost_time:null,location:"",category:null,contact:"",images:[]},categories:[],fileList:[],rules:{title:[{required:!0,message:"请输入标题",trigger:"blur"}],description:[{required:!0,message:"请输入详细描述",trigger:"blur"}],lost_time:[{required:!0,message:"请选择丢失时间",trigger:"change"}],location:[{required:!0,message:"请输入地点",trigger:"blur"}],category:[{required:!0,message:"请选择物品分类",trigger:"change"}],contact:[{required:!0,message:"请输入联系方式",trigger:"blur"}]},isSubmitting:!1}},mounted(){this.fetchCategories()},methods:{async fetchCategories(){try{const e=await a.A.get("/api/categories/");this.categories=e.data}catch(e){console.error("获取物品分类失败:",e),this.$message.error("获取物品分类失败，请稍后重试。")}},async submitForm(){try{const e=await a.A.post("/api/items/lost/",this.form),t=e.data.id;for(let r=0;r<this.form.images.length;r++){const e=new FormData;e.append("image",this.form.images[r]),e.append("item_id",t),await a.A.post("/api/upload/",e,{headers:{"Content-Type":"multipart/form-data"}})}this.$message.success("失物信息已成功登记"),await this.$router.push("/items/lost/list")}catch(e){this.$message.error("提交失败，请检查输入信息。")}},handleUploadSuccess(e){this.form.images.push(e.url)},beforeUpload(e){const t="image/jpeg"===e.type||"image/png"===e.type;t||this.$message.error("只能上传 JPG/PNG 格式的图片！");const r=e.size/1024/1024<2;return r||this.$message.error("图片大小不能超过 2MB！"),t&&r}}},l=s,m=r(1656),n=(0,m.A)(l,o,i,!1,null,"09c14f66",null),c=n.exports}}]);
//# sourceMappingURL=724.9774c34d.chunk.js.map