"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[789],{116:function(t,e,i){var r=i(6518),a=i(2652),o=i(9306),n=i(8551),s=i(1767);r({target:"Iterator",proto:!0,real:!0},{find:function(t){n(this),o(t);var e=s(this),i=0;return a(e,(function(e,r){if(t(e,i++))return r(e)}),{IS_RECORD:!0,INTERRUPTED:!0}).result}})},655:function(t,e,i){var r=i(6955),a=String;t.exports=function(t){if("Symbol"===r(t))throw new TypeError("Cannot convert a Symbol value to a string");return a(t)}},713:function(t,e,i){var r=i(9565),a=i(9306),o=i(8551),n=i(1767),s=i(9462),l=i(6319),c=s((function(){var t=this.iterator,e=o(r(this.next,t)),i=this.done=!!e.done;if(!i)return l(t,this.mapper,[e.value,this.counter++],!0)}));t.exports=function(t){return o(this),a(t),new c(n(this),{mapper:t})}},1701:function(t,e,i){var r=i(6518),a=i(713),o=i(6395);r({target:"Iterator",proto:!0,real:!0,forced:o},{map:a})},2529:function(t){t.exports=function(t,e){return{value:t,done:e}}},2812:function(t){var e=TypeError;t.exports=function(t,i){if(t<i)throw new e("Not enough arguments");return t}},4603:function(t,e,i){var r=i(6840),a=i(9504),o=i(655),n=i(2812),s=URLSearchParams,l=s.prototype,c=a(l.append),m=a(l["delete"]),d=a(l.forEach),p=a([].push),u=new s("a=1&a=2&b=3");u["delete"]("a",1),u["delete"]("b",void 0),u+""!=="a=2"&&r(l,"delete",(function(t){var e=arguments.length,i=e<2?void 0:arguments[1];if(e&&void 0===i)return m(this,t);var r=[];d(this,(function(t,e){p(r,{key:e,value:t})})),n(e,1);var a,s=o(t),l=o(i),u=0,f=0,h=!1,g=r.length;while(u<g)a=r[u++],h||a.key===s?(h=!0,m(this,a.key)):f++;while(f<g)a=r[f++],a.key===s&&a.value===l||c(this,a.key,a.value)}),{enumerable:!0,unsafe:!0})},5789:function(t,e,i){i.r(e),i.d(e,{default:function(){return m}});var r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"lost-item-register"},[e("h1",[t._v("📝 失物登记")]),e("el-form",{ref:"formRef",attrs:{model:t.form,"label-width":"120px",rules:t.rules,"label-position":"top"}},[e("el-form-item",{attrs:{label:"物品标题",prop:"title"}},[e("el-input",{attrs:{placeholder:"请输入物品名称（如：黑色华为手机）"},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1),e("el-form-item",{attrs:{label:"详细描述",prop:"description"}},[e("el-input",{attrs:{type:"textarea",rows:4,placeholder:"请尽可能详细描述物品特征（如：型号、特殊标记等）","show-word-limit":"",maxlength:"300"},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1),e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"丢失时间",prop:"lost_time"}},[e("el-date-picker",{attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm","value-format":"yyyy-MM-ddTHH:mm",placeholder:"选择具体时间"},model:{value:t.form.lost_time,callback:function(e){t.$set(t.form,"lost_time",e)},expression:"form.lost_time"}})],1)],1),e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"丢失地点",prop:"location"}},[e("el-input",{attrs:{placeholder:"例如：3号教学楼201教室"},model:{value:t.form.location,callback:function(e){t.$set(t.form,"location",e)},expression:"form.location"}}),e("el-button",{staticClass:"map-btn",attrs:{type:"primary",icon:"el-icon-map-location",plain:""},on:{click:t.showMapDialog}},[t._v("选择位置 ")])],1)],1)],1),e("el-form-item",{attrs:{label:"物品分类",prop:"category"}},[e("el-select",{attrs:{placeholder:"请选择最匹配的分类",filterable:""},model:{value:t.form.category,callback:function(e){t.$set(t.form,"category",e)},expression:"form.category"}},t._l(t.categories,(function(t){return e("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),e("el-form-item",{attrs:{label:"联系方式",prop:"contact"}},[e("el-input",{attrs:{placeholder:"手机号或邮箱"},model:{value:t.form.contact,callback:function(e){t.$set(t.form,"contact",e)},expression:"form.contact"}})],1),e("el-form-item",{attrs:{label:"物品照片"}},[e("el-upload",{attrs:{action:"#","list-type":"picture-card","auto-upload":!1,"on-change":t.handleUploadSuccess,"file-list":t.form.images,"before-upload":t.beforeUpload}},[e("i",{staticClass:"el-icon-plus"})]),e("div",{staticClass:"el-upload__tip"},[t._v(" 支持上传 JPG/PNG 格式图片，单张不超过5MB ")])],1),e("el-form-item",[e("el-button",{staticClass:"submit-btn",attrs:{type:"primary",loading:t.isSubmitting},on:{click:t.submitForm}},[t._v(" "+t._s(t.isSubmitting?"提交中...":"立即登记")+" ")])],1)],1),e("el-dialog",{attrs:{title:"✅ 登记成功",visible:t.dialogVisible,width:"700px"},on:{"update:visible":function(e){t.dialogVisible=e},closed:t.handleDialogClosed}},[e("el-descriptions",{attrs:{column:2,border:"","label-class-name":"detail-label"}},[e("el-descriptions-item",{attrs:{label:"物品标题"}},[t._v(t._s(t.submittedItem.title))]),e("el-descriptions-item",{attrs:{label:"分类"}},[t._v(" "+t._s(t.getCategoryName(t.submittedItem.category))+" ")]),e("el-descriptions-item",{attrs:{label:"丢失时间"}},[t._v(" "+t._s(t.submittedItem.lost_time)+" ")]),e("el-descriptions-item",{attrs:{label:"丢失地点"}},[t._v(t._s(t.submittedItem.location))]),e("el-descriptions-item",{attrs:{label:"联系方式",span:2}},[e("el-link",{attrs:{type:"primary"}},[t._v(t._s(t.submittedItem.contact))])],1),e("el-descriptions-item",{attrs:{label:"详细描述",span:2}},[e("pre",{staticClass:"description-pre"},[t._v(t._s(t.submittedItem.description))])]),t.submittedItem.images?.length?e("el-descriptions-item",{attrs:{label:"物品照片",span:2}},t._l(t.submittedItem.images,(function(t,i){return e("el-image",{key:i,staticClass:"detail-image",attrs:{src:t.url,fit:"cover"}})})),1):t._e()],1),e("span",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"success"},on:{click:t.handleConfirm}},[t._v(" 打印回执 (Ctrl+P) ")]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){t.dialogVisible=!1}}},[t._v(" 确定返回 ")])],1)],1),e("el-dialog",{attrs:{title:"请在地图上选择位置",visible:t.mapDialogVisible,width:"80%"},on:{"update:visible":function(e){t.mapDialogVisible=e}}},[e("div",{staticStyle:{height:"500px",position:"relative"},attrs:{id:"map-container"}},[t.mapLoading?e("div",{staticClass:"map-loading"},[e("i",{staticClass:"el-icon-loading"}),t._v(" 正在获取地址信息... ")]):t._e()]),e("span",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.mapDialogVisible=!1}}},[t._v("取消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.confirmLocation}},[t._v("确定")])],1)])],1)},a=[],o=(i(8111),i(116),i(7588),i(1701),i(4603),i(7566),i(8721),i(4335)),n={data(){return{phoneRules:[{required:!0,message:"请输入联系方式",trigger:"blur"},{pattern:/^(1[3-9]\d{9}|[\w-]+@[\w-]+\.[\w-]+)$/,message:"请输入有效的手机号或邮箱",trigger:"blur"}],form:{title:"",description:"",lost_time:null,location:"",category:null,contact:"",images:[],location_lng:null,location_lat:null},categories:[],fileList:[],rules:{title:[{required:!0,message:"请输入标题",trigger:"blur"}],description:[{required:!0,message:"请输入详细描述",trigger:"blur"}],lost_time:[{required:!0,message:"请选择丢失时间",trigger:"change"}],location:[{required:!0,message:"请输入地点",trigger:"blur"}],category:[{required:!0,message:"请选择物品分类",trigger:"change"}],contact:[{required:!0,message:"请输入联系方式",trigger:"blur"}]},isSubmitting:!1,dialogVisible:!1,submittedItem:{},printStyle:"\n      @media print {\n        body * { visibility: hidden; }\n        .el-dialog { width: 210mm!important; visibility: visible; }\n        .el-dialog__header, .el-dialog__footer { display: none; }\n      }\n    ",mapDialogVisible:!1,selectedLocation:{lng:null,lat:null,address:""},map:null,geocoder:null,mapLoading:!1,marker:null,infoWindow:null}},mounted(){if(this.fetchCategories(),window._AMapSecurityConfig={securityJsCode:"d43a12d0b69aeacd6f9016db9b366433"},!window.AMap){const t="db70318a1cf1f196b2746f10cb9df826",e=document.createElement("script");e.src=`https://webapi.amap.com/maps?v=2.0&key=${t}&plugin=AMap.Geocoder,AMap.ToolBar,AMap.Scale`,e.async=!0,e.onload=()=>{this.geocoder=new AMap.Geocoder({city:"全国",timeout:5e3}),console.log("AMap SDK and all plugins loaded")},document.head.appendChild(e)}},methods:{showMapDialog(){this.mapDialogVisible=!0,this.$nextTick((()=>{this.initAMap()}))},initAMap(){if(!window.AMap)return;const t=new AMap.LngLat(112.662198,37.745788);this.map=new AMap.Map("map-container",{zoom:15,center:t,resizeEnable:!0,securityJsCode:"d43a12d0b69aeacd6f9016db9b366433",useAMapUI:!0}),this.map.addControl(new AMap.ToolBar({position:"LT"})),this.map.addControl(new AMap.Scale({position:"LB"})),this.infoWindow=new AMap.InfoWindow({offset:new AMap.Pixel(0,-30)}),this.map.on("click",(t=>{try{this.mapLoading=!0,this.marker&&this.map.remove(this.marker),this.marker=new AMap.Marker({position:t.lnglat,title:"选择的位置"}),this.map.add(this.marker),this.map.setCenter(t.lnglat);const e=new AMap.Geocoder;e.getAddress(t.lnglat,((e,i)=>{try{if(this.mapLoading=!1,"complete"===e&&"OK"===i.info){const e=i.regeocode.formattedAddress;this.selectedLocation={lng:t.lnglat.getLng(),lat:t.lnglat.getLat(),address:e},this.form.location=e,this.infoWindow.setContent(`<div class="map-info">\n          <h4>已选择位置：</h4>\n          <p>${e}</p>\n        </div>`),this.infoWindow.open(this.map,t.lnglat)}else console.error("地址解析失败:",i),this.$message.warning("无法获取该位置地址，请重新选择")}catch(r){console.error("地址解析异常:",r),this.$message.warning("地址解析服务异常")}}))}catch(e){this.mapLoading=!1,console.error("地址解析异常:",e),this.$message.warning("位置选择过程发生错误")}}))},confirmLocation(){this.selectedLocation.address?(this.form.location=this.selectedLocation.address,this.form.location_lng=this.selectedLocation.lng,this.form.location_lat=this.selectedLocation.lat,this.mapDialogVisible=!1,this.marker&&this.map.remove(this.marker),this.infoWindow.close()):this.$message.warning("请先在地图上选择位置")},getCategoryName(t){return this.categories.find((e=>e.id===t))?.name||"未知分类"},handleDialogClosed(){this.$router.go(-1)},handleConfirm(){const t=window.open("","_blank");t.document.write(`\n      <style>${this.printStyle}</style>\n      ${document.querySelector(".el-dialog").outerHTML}\n    `),t.print(),t.close()},async fetchCategories(){try{const t=await o.A.get("/api/lost/categories/");this.categories=t.data}catch(t){console.error("获取物品分类失败:",t),this.$message.error("获取物品分类失败，请稍后重试。")}},async submitForm(){try{this.isSubmitting=!0;const t=new FormData;Object.keys(this.form).forEach((e=>{if("images"!==e){const i=this.form[e];null===i||void 0===i?t.append(e,""):t.append(e,i)}})),this.form.images.forEach((e=>{t.append("images",e.raw)}));const e=await o.A.post("/api/items/lost/",t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Token ${this.$store.state.token}`}});this.submittedItem={...e.data,images:this.form.images},this.$refs.formRef.resetFields(),this.form.images=[],this.dialogVisible=!0,this.$message.success({message:"登记成功，3秒后自动跳转",duration:3e3})}catch(t){const e=t.response?.data?.detail||"提交失败，请检查网络连接";this.$message.error(e)}finally{this.isSubmitting=!1}},handleUploadSuccess(t){if(t&&t.raw)try{const e=URL.createObjectURL(t.raw),i={uid:t.uid,name:t.name,status:"ready",percentage:0,url:e,raw:t.raw};this.form.images=[...this.form.images,i]}catch(e){console.error("文件预览错误:",e),this.$message.error("不支持该文件类型")}else this.$message.error("文件加载异常")},beforeUpload(t){const e=["image/jpeg","image/png"].includes(t.type),i=t.size/1024/1024<5;return e?!!i||(this.$message.error("图片大小不能超过5MB"),!1):(this.$message.error("仅支持 JPG/PNG 格式"),!1)}}},s=n,l=i(1656),c=(0,l.A)(s,r,a,!1,null,"d7a45536",null),m=c.exports},6279:function(t,e,i){var r=i(6840);t.exports=function(t,e,i){for(var a in e)r(t,a,e[a],i);return t}},6319:function(t,e,i){var r=i(8551),a=i(9539);t.exports=function(t,e,i,o){try{return o?e(r(i)[0],i[1]):e(i)}catch(n){a(t,"throw",n)}}},7566:function(t,e,i){var r=i(6840),a=i(9504),o=i(655),n=i(2812),s=URLSearchParams,l=s.prototype,c=a(l.getAll),m=a(l.has),d=new s("a=1");!d.has("a",2)&&d.has("a",void 0)||r(l,"has",(function(t){var e=arguments.length,i=e<2?void 0:arguments[1];if(e&&void 0===i)return m(this,t);var r=c(this,t);n(e,1);var a=o(i),s=0;while(s<r.length)if(r[s++]===a)return!0;return!1}),{enumerable:!0,unsafe:!0})},7588:function(t,e,i){var r=i(6518),a=i(2652),o=i(9306),n=i(8551),s=i(1767);r({target:"Iterator",proto:!0,real:!0},{forEach:function(t){n(this),o(t);var e=s(this),i=0;a(e,(function(e){t(e,i++)}),{IS_RECORD:!0})}})},8721:function(t,e,i){var r=i(3724),a=i(9504),o=i(2106),n=URLSearchParams.prototype,s=a(n.forEach);r&&!("size"in n)&&o(n,"size",{get:function(){var t=0;return s(this,(function(){t++})),t},configurable:!0,enumerable:!0})},9462:function(t,e,i){var r=i(9565),a=i(2360),o=i(6699),n=i(6279),s=i(8227),l=i(1181),c=i(5966),m=i(7657).IteratorPrototype,d=i(2529),p=i(9539),u=s("toStringTag"),f="IteratorHelper",h="WrapForValidIterator",g=l.set,b=function(t){var e=l.getterFor(t?h:f);return n(a(m),{next:function(){var i=e(this);if(t)return i.nextHandler();if(i.done)return d(void 0,!0);try{var r=i.nextHandler();return i.returnHandlerResult?r:d(r,i.done)}catch(a){throw i.done=!0,a}},return:function(){var i=e(this),a=i.iterator;if(i.done=!0,t){var o=c(a,"return");return o?r(o,a):d(void 0,!0)}if(i.inner)try{p(i.inner.iterator,"normal")}catch(n){return p(a,"throw",n)}return a&&p(a,"normal"),d(void 0,!0)}})},v=b(!0),y=b(!1);o(y,u,"Iterator Helper"),t.exports=function(t,e,i){var r=function(r,a){a?(a.iterator=r.iterator,a.next=r.next):a=r,a.type=e?h:f,a.returnHandlerResult=!!i,a.nextHandler=t,a.counter=0,a.done=!1,g(this,a)};return r.prototype=e?v:y,r}}}]);
//# sourceMappingURL=789.af99cf19.chunk.js.map